"""
–ü—Ä–æ—Å—Ç–æ–π Telegram –±–æ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, —Ö—Ä–∞–Ω—è—â–∏–º–∏—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞!
"""
import asyncio
import logging
import os
from aiogram import Bot, Dispatcher, Router, F, types
from aiogram.filters import CommandStart
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardBuilder
from dotenv import load_dotenv

load_dotenv()

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = os.getenv("BOT_TOKEN", "YOUR_BOT_TOKEN_HERE")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# --- –î–∞–Ω–Ω—ã–µ –¥–ª—è –±–æ—Ç–∞ ---
CARD_DATA = {
    "üòä –†–∞–¥–æ—Å—Ç—å": "–¢—ã –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π! –í–ø–µ—Ä–µ–¥–∏ —Ç–µ–±—è –∂–¥—É—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —É—Å–ø–µ—Ö–∏. –í–æ—Å–ø–æ–ª—å–∑—É–π—Å—è —ç—Ç–∏–º –º–æ–º–µ–Ω—Ç–æ–º! üåü",
    "üò¥ –£—Å—Ç–∞–ª–æ—Å—Ç—å": "–¢–≤–æ–µ–º—É —Ç–µ–ª—É –∏ –¥—É—à–µ –Ω—É–∂–µ–Ω –æ—Ç–¥—ã—Ö. –ü–æ–∑–≤–æ–ª—å —Å–µ–±–µ –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã. –ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ - —ç—Ç–æ –Ω–µ —ç–≥–æ–∏–∑–º! üí§",
    "üò† –ó–ª–æ—Å—Ç—å": "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –º–æ—â–Ω–∞—è, –Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–µ —Ä—É—Å–ª–æ. –ü–æ–ø—Ä–æ–±—É–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É —ç–Ω–µ—Ä–≥–∏—é –≤ –¥–µ–π—Å—Ç–≤–∏–µ. üî•",
    "üò¢ –ì—Ä—É—Å—Ç—å": "–¢–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü–æ–∑–≤–æ–ª—å —Å–µ–±–µ –ø—Ä–æ–∂–∏—Ç—å —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç, –∞ –∑–∞—Ç–µ–º –æ—Ç–ø—É—Å—Ç–∏ –µ–≥–æ. –í—Ä–µ–º—è –ª–µ—á–∏—Ç —Ä–∞–Ω—ã. üåßÔ∏è",
    "üò∞ –¢—Ä–µ–≤–æ–≥–∞": "–¢–≤–æ–π —É–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ —Ä–µ—à–µ–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º. –í–æ–∑—å–º–∏ –ø–∞—É–∑—É, –¥—ã—à–∏ –≥–ª—É–±–æ–∫–æ –∏ —Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å. üßò",
}

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
router = Router()

def get_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏"""
    builder = ReplyKeyboardBuilder()
    for state in CARD_DATA.keys():
        builder.add(KeyboardButton(text=state))
    builder.adjust(2)
    return builder.as_markup(resize_keyboard=True, one_time_keyboard=True)

# --- –•—ç–Ω–¥–ª–µ—Ä—ã ---

@router.message(CommandStart())
async def cmd_start(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    keyboard = get_keyboard()
    await message.answer(
        "üîÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏ —Å–≤–æ–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:\n\n"
        "–Ø –≤—ã—Ç—è–Ω—É –¥–ª—è —Ç–µ–±—è –∫–∞—Ä—Ç—É –º—É–¥—Ä–æ—Å—Ç–∏.",
        reply_markup=keyboard
    )

@router.message(CommandStart())
async def cmd_help(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ /help"""
    await message.answer(
        "‚ÑπÔ∏è <b>–°–ø—Ä–∞–≤–∫–∞:</b>\n\n"
        "–≠—Ç–æ—Ç –±–æ—Ç - —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç. –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, "
        "–∏ —è –¥–∞–º —Ç–µ–±–µ —Å–æ–≤–µ—Ç –æ—Ç –í—Å–µ–ª–µ–Ω–Ω–æ–π.\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/start - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\n"
        "/help - —Å–ø—Ä–∞–≤–∫–∞",
        parse_mode="HTML"
    )

@router.message(F.text.in_(CARD_DATA.keys()))
async def send_card(message: Message):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ä—Ç—É –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é"""
    card_text = CARD_DATA.get(message.text)
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
    await message.answer(
        f"<b>{message.text}</b>\n\n{card_text}",
        parse_mode="HTML",
        reply_markup=types.ReplyKeyboardRemove()
    )
    
    # –ü–∞—É–∑–∞ –¥–ª—è –¥—Ä–∞–º–∞—Ç—É—Ä–≥–∏–∏
    await asyncio.sleep(1)
    
    # CTA (Call to Action)
    await message.answer(
        "‚ú® –•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ —Å–µ–±–µ? –í—ã–±–µ—Ä–∏ /start –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã "
        "–∏–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!"
    )

@router.message()
async def echo(message: Message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    await message.answer(
        "–Ø –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª... ü§î\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–Ω–æ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–ª–∏ –Ω–∞–∂–º–∏ /start –¥–ª—è –Ω–∞—á–∞–ª–∞.\n"
        "/help - –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏"
    )

# --- –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ---

async def main():
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
    if BOT_TOKEN == "YOUR_BOT_TOKEN_HERE":
        logger.error("‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –£–∫–∞–∂–∏ –µ–≥–æ –≤ —Ñ–∞–π–ª–µ .env")
        return
    
    logger.info("üöÄ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
    bot = Bot(token=BOT_TOKEN)
    dp = Dispatcher()
    dp.include_router(router)
    
    try:
        # –ù–∞—á–∏–Ω–∞–µ–º –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å Telegram (polling)
        await dp.start_polling(bot, allowed_updates=dp.resolve_used_update_types())
    finally:
        await bot.session.close()

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        logger.info("‚è∏Ô∏è –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
